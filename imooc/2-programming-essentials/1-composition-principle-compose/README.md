# 计算机组成原理之组成篇

## 计算机的总线

### 总线的概述

总线解决不同设备之间的通信问题。

![总线](assets/bus.png)

#### 片内总线

高集成度芯片内部的信息传输线。

![片内总线](assets/chip-bus.png)

#### 系统总线

`CPU`、主内存、`IO`设备、各组件之间的信息传输线。

![系统总线](assets/system-bus.png)

- 数据总线：双向传输各个部件的数据信息；数据总线的位数是数据总线的重要参数(一般与`CPU`位数相同)。
- 地址总线：指定源数据或目的数据在内存中的地址；地址总线的位数与存储单元有关；地址总线位数为`n`时，寻址范围为`0~2^n`。
- 控制总线：控制总线是用来发出各种控制信号的传输线；控制信号经由控制总线从一个组件发给另外一个组件；控制总线可以监视不同组件之间的状态(就绪/未就绪)。

### 总线的仲裁

#### 为什么需要仲裁

当多个设备就绪时，都想通过总线交换数据，就会产生冲突。

![仲裁背景](assets/why-arbitrate.png)

仲裁是为了解决总线使用权的冲突问题。

#### 链式查询

- 好处：电路复杂度低，仲裁方式简单。
- 坏处：优先级低的设备难以获得总线使用权。
- 坏处：对电路故障敏感。

![链式查询](assets/chain-query.png)

#### 计时器定时查询

- 仲裁控制器对设备编号并使用计数器累计计数。
- 接收到仲裁信号后，往所有设备发出计数值。
- 计数值与设备编号一致时则获得总线使用权。

![计时器定时查询](assets/timing-query.png)

#### 独立请求

- 每个设备均有总线独立连接仲裁器。
- 设备可单独向仲裁器发送请求和接受请求。
- 当同时收到多个请求信号，仲裁器有权按优先级分配使用权。
- 好处：响应速度快，优先顺序可动态改变。
- 坏处：设备连线多，总线控制复杂。

![独立请求](assets/independent-request.png)

## 计算机的输入输出设备

### 常见的输入输出设备

- 字符输入设备：键盘。
- 图形输入设备：鼠标、数位板、扫描仪。
- 图像输出设备：显示器、打印机、投影仪。

### 输入输出接口的通用设计

- 数据线：是`IO`设备与主机之间进行数据交换的传送线；分为单向传输数据线、双向传输数据线。
- 状态线：`IO`设备状态向主机报告的信号线；查询设备是否已经正常连接并就绪；查询设备是否已经被占用。
- 命令线：`CPU`向设备发送命令的信号线；发送读写信号；发送启动停止信号。
- 设备选择线：主机选择`IO`设备进行操作的信号线；对连在总线上的设备进行选择。

### CPU与IO设备的通信

`CPU`速度与`IO`设备速度不一致。

#### 程序中断

当外围`IO`设备就绪时，向`CPU`发出中断信号，`CPU`有专门的电路响应中断信号。

![程序中断](assets/interrupt.png)

提供低速设备通知`CPU`的一种异步的方式；`CPU`可以高速运转同时兼顾低速设备的响应。

#### DMA(直接存储访问)

`DMA`直接连接主存与`IO`设备；`DMA`工作时不需要`CPU`的参与。

当主存与`IO`设备交换信息时，不需要中断`CPU`，可以提高`CPU`的效率。

![DMA](assets/dma.png)